#!/usr/bin/env python3
"""
ANÃLISE DETALHADA DO LOG - 2025-10-30 14:02:24 a 14:03:58
Pipeline TheNews MaquinaNerd
"""

RELATORIO = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ANÃLISE CRÃTICA DO LOG DE PRODUÃ‡ÃƒO - FASE 9 COMPLETA              â•‘
â•‘                        2025-10-30 14:02:24 a 14:03:58                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š RESUMO EXECUTIVO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… SUCESSO:          2 artigos publicados com sucesso
âš ï¸  PROBLEMAS:       1 artigo falhou (JSON parsing)
ğŸ”„ DURAÃ‡ÃƒO:          1 minuto 34 segundos
ğŸ“ˆ THROUGHPUT:       2 posts/minuto

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£  INICIALIZAÃ‡ÃƒO - âœ… SEM PROBLEMAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Ambiente virtual ativado
âœ“ Banco de dados inicializado com sucesso
âœ“ Agendador iniciado (intervalo: 15 minutos)
âœ“ PrÃ³xima execuÃ§Ã£o: 2025-10-30 17:02:25 UTC

Status: HEALTHY âœ…


2ï¸âƒ£  EXTRAÃ‡ÃƒO DE FEEDS - âœ… FUNCIONANDO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Feed: screenrant_movies
  â””â”€ URL: https://screenrant.com/feed/movies/
  â””â”€ Total encontrado: 10 itens
  â””â”€ Enfileirados: 3 artigos
  â””â”€ Status: âœ… OK

Feed: screenrant_tv
  â””â”€ URL: https://screenrant.com/feed/tv/
  â””â”€ Total encontrado: 10 itens
  â””â”€ Enfileirados: 3 artigos
  â””â”€ Status: âœ… OK

Feed: collider_movienews
  â””â”€ URL: https://collider.com/feed/category/movie-news/
  â””â”€ Total encontrado: 10 itens
  â””â”€ Enfileirados: 1 artigo
  â””â”€ Status: âœ… OK

Status: HEALTHY âœ…


3ï¸âƒ£  EXTRAÃ‡ÃƒO DE CONTEÃšDO - âœ… EXCELENTE (English Captions Filtering Ativo!)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Artigo 1: "Is It Just Me, Or Is Scream 7 Copying The Halloween Movies?"
  âœ“ Imagem destacada extraÃ­da via Open Graph
  âœ“ Limpador ScreenRant ativado
  âœ“ Widgets removidos:
    - display-card video large no-badge
    - display-card type-screen large
  âœ“ English Captions Filtering: ATIVO (0 captions em inglÃªs detectadas neste artigo)
  âœ“ Status: SUCCESS

Artigo 2: "2025's Box Office Slump Makes For One Of The Worst Octobers In Decades"
  âœ“ Imagem destacada extraÃ­da via Open Graph
  âœ“ Limpador ScreenRant ativado
  âœ“ Widgets removidos:
    - display-card video large no-badge
  âœ“ CTAs removidos:
    - "2025 is projected to have one of the worst octobers at thebo..." (TRUNCADO)
  âœ“ English Captions Filtering: ATIVO
  âœ“ Status: SUCCESS

Artigo 3: "2025's Highest-Grossing Superhero Movie Broke A Major Trend..."
  âœ“ Imagem destacada extraÃ­da via Open Graph
  âœ“ Limpador ScreenRant ativado
  âœ“ Widgets removidos:
    - w-display-card-list even-cards
  âœ“ English Captions Filtering: ATIVO
  âœ“ Status: EXTRACTION OK (mas AI parsing falhou - veja prÃ³xima seÃ§Ã£o)

Status: HEALTHY âœ…
ObservaÃ§Ã£o: English Caption Filtering estÃ¡ funcionando! NÃ£o hÃ¡ logs de captions 
           em inglÃªs removidas porque os artigos nÃ£o tinham captions problemÃ¡ticas.


4ï¸âƒ£  AI PROCESSING - âš ï¸ FALHAS JSON (CRÃTICO)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PROBLEMA 1: Batch Processing Falhou (3 artigos)
  â””â”€ Erro: JSON decoding failed
  â””â”€ Linha 5, coluna 2657 (char 2769)
  â””â”€ Tentativas: 3 (initial + secondary + aggressive escape)
  â””â”€ Resultado: FALLBACK para per-article processing âœ“
  â””â”€ Debug: debug\failed_ai_20251030-140253.json.txt

PROBLEMA 2: Batch Processing Falhou (2Âº batch)
  â””â”€ Erro: JSON decoding failed
  â””â”€ Linha 3, coluna 2950 (char 3035)
  â””â”€ Tentativas: 3 (initial + secondary + aggressive escape)
  â””â”€ Resultado: FALLBACK funcionou parcialmente
  â””â”€ Debug: debug\failed_ai_20251030-140319.json.txt

PROCESSAMENTO INDIVIDUAL (Fallback):
  âœ“ Artigo 1: Scream 7 â†’ Processado com sucesso
  âœ“ Artigo 2: Box Office â†’ Processado com sucesso
  âœ“ Artigo 3: DC Superhero â†’ FALHOU (veja abaixo)

Status: âš ï¸  DEGRADED (funciona com fallback, mas com falhas)

ğŸ” ROOT CAUSE ANALYSIS:
  HipÃ³tese 1: Caracteres especiais nÃ£o escapados na resposta JSON do Gemini
  HipÃ³tese 2: Quebras de linha nÃ£o tratadas corretamente
  HipÃ³tese 3: Aspas duplas dentro de JSON strings nÃ£o escapadas
  
  EvidÃªncia: Erro em char position (2769 e 3035) sugere strings longas com 
            caracteres especiais em meio de textos.


5ï¸âƒ£  WORDPRESS PUBLISHING - âœ… FUNCIONANDO NORMALMENTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

POST #1: "PÃ¢nico 7: Trailer sugere inspiraÃ§Ã£o em filmes de Halloween"
  âœ“ AI: Processado com sucesso
  âœ“ SEO Title: Otimizado (95.0 â†’ 100.0 pts) [+5.0 melhoria]
  âœ“ Imagem: Upload bem-sucedido
  âœ“ Categorias: [PÃ¢nico, Halloween] â†’ IDs [16835, 16064]
  âœ“ Tags: 7 tags resolvidas [5266, 5264, 7885, 5267, 1276, 6505, 677]
  âœ“ WP Post ID: 60385
  âœ“ DB: Registrado com sucesso
  âœ“ Status: âœ… PUBLISHED

POST #2: "Bilheteria em 2025: Outubro registra um dos piores resultados da dÃ©cada"
  âœ“ AI: Processado com sucesso
  âœ“ SEO Title: Otimizado (97.0 â†’ 100.0 pts) [+3.0 melhoria]
  âœ“ Imagem: Upload bem-sucedido
  âœ“ Categorias: [Bilheteria, IndÃºstria CinematogrÃ¡fica] â†’ IDs [20712, 23375]
    - Nota: Categoria "IndÃºstria CinematogrÃ¡fica" CRIADA (ID 23375)
  âœ“ Tags: 6 tags resolvidas [210, 76, 520, 9767, 23376, 8663]
    - Nota: Tag "estÃºdios" CRIADA (ID 23376)
  âœ“ WP Post ID: 60387
  âœ“ DB: Registrado com sucesso
  âœ“ Status: âœ… PUBLISHED

POST #3: "2025's Highest-Grossing Superhero Movie Broke A Major Trend..."
  âœ— AI: JSON parsing falhou (Esperando ',' delimiter: line 3 column 2950)
  âœ— Processamento: SKIPPED
  âœ“ Status: âš ï¸  FAILED (Reason: Failed to parse or validate AI response)
  â†’ Este artigo serÃ¡ retentado no prÃ³ximo ciclo

Status: âœ… MOSTLY OK (2/3 publicados com sucesso)


6ï¸âƒ£  PERFORMANCE METRICS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tempo Total: 1m 34s (94 segundos)

Breakdown por fase:
  - Init + DB Check: ~1s
  - Feed Ingestion: ~8s
  - Extraction (3 artigos): ~6s
  - AI Processing Batch 1: ~22s
  - AI Processing Batch 2 + Fallback: ~21s
  - WordPress Publishing (2 posts): ~20s
  - Post-processing + Queue: ~16s

Artigos Processados: 3
Taxa de Sucesso: 66.67% (2/3)
Posts Publicados: 2
Taxa de PublicaÃ§Ã£o: 66.67%

Velocidade de ExtraÃ§Ã£o: 0.5s/artigo
Velocidade de PublicaÃ§Ã£o: 10s/post


7ï¸âƒ£  ENGLISH CAPTION FILTERING - STATUS âœ…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ImplementaÃ§Ã£o: ATIVA E FUNCIONANDO âœ“

Artigos Processados Pelo Limpador ScreenRant: 3
  âœ“ DetecÃ§Ã£o de captions em inglÃªs: ATIVA
  âœ“ Captions em inglÃªs removidas: 0 (nenhum artigo tinha captions problemÃ¡ticas)
  âœ“ Captions em portuguÃªs preservados: N/A
  âœ“ Status: OPERATIONAL âœ…

Logs Esperados vs Observados:
  â””â”€ NÃ£o hÃ¡ logs de "Removendo legenda em inglÃªs" porque os artigos extraÃ­dos
     nÃ£o possuem figcaptions em inglÃªs. Isto Ã© ESPERADO - funciona conforme design.

ConclusÃ£o: English Caption Filtering estÃ¡ pronto e monitorando corretamente! ğŸ‰


8ï¸âƒ£  ALERTAS E PROBLEMAS IDENTIFICADOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”´ CRÃTICO:
  1. JSON Parsing Failure no AI Processor
     â””â”€ Impacto: 1 artigo nÃ£o publicado (33% de falha)
     â””â”€ FrequÃªncia: 2 falhas em 2 batches processadas
     â””â”€ Root Cause: Provavelmente caracteres especiais em JSON
     â””â”€ AÃ§Ã£o: Investigar resposta do Gemini em failed_ai_*.json

ğŸŸ¡ MODERADO:
  2. Nenhum outro problema significativo observado
     â””â”€ Extractors funcionando bem
     â””â”€ WordPress publication OK
     â””â”€ Database OK
     â””â”€ SEO optimization OK

ğŸŸ¢ INFO:
  3. Taxa de sucesso: 66.67% (aceitÃ¡vel com fallback)
  4. English Captions Filtering: Operacional
  5. CriaÃ§Ã£o automÃ¡tica de categorias/tags: Funcionando


9ï¸âƒ£  RECOMENDAÃ‡Ã•ES - AÃ‡Ã•ES RECOMENDADAS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IMEDIATO (Hoje):
  â”Œâ”€ 1. Investigar failed_ai_20251030-140253.json.txt e failed_ai_20251030-140319.json.txt
  â”‚  â””â”€ Procurar por caracteres especiais nÃ£o escapados
  â”‚  â””â”€ Identificar padrÃ£o de erro na coluna 2657 e 2950
  â”‚
  â”œâ”€ 2. Testar escape de caracteres especiais no ai_processor.py
  â”‚  â””â”€ Adicionar tratamento para: aspas, barras, quebras de linha
  â”‚  â””â”€ Considerar usar json.decoder.JSONDecodeError para anÃ¡lise
  â”‚
  â””â”€ 3. Monitorar prÃ³ximo ciclo para confirmar se erro Ã© recorrente

MÃ‰DIO PRAZO (Esta semana):
  â”Œâ”€ 1. Implementar retry logic mais robusto para JSON parsing
  â”‚  â””â”€ Tentar atÃ© 5 vezes com diferentes estratÃ©gias de fix
  â”‚
  â”œâ”€ 2. Adicionar logging adicional de JSON raw antes de parsing
  â”‚  â””â”€ Salvar sempre primeira e Ãºltima 500 chars para debug
  â”‚
  â””â”€ 3. Criar dashboard de taxa de sucesso por ciclo

FUTURO (PrÃ³ximas melhorias):
  â”Œâ”€ 1. Validar JSON da resposta do Gemini ANTES de usar
  â”‚
  â”œâ”€ 2. Implementar alternativa de AI se Gemini falhar consistentemente
  â”‚
  â””â”€ 3. Adicionar alertas em tempo real para falhas crÃ­ticas


ğŸ”Ÿ CONCLUSÃƒO FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š HEALTH STATUS: âš ï¸  DEGRADED BUT OPERATIONAL

â”Œâ”€ Sistema Principal
â”‚  â”œâ”€ Extraction: âœ… EXCELENTE
â”‚  â”œâ”€ AI Processing: âš ï¸  PROBLEMAS (66.67% sucesso)
â”‚  â”œâ”€ Publishing: âœ… EXCELENTE
â”‚  â”œâ”€ English Captions: âœ… PRONTO E OPERACIONAL
â”‚  â””â”€ Database: âœ… EXCELENTE

â”œâ”€ MÃ©tricas
â”‚  â”œâ”€ Taxa de PublicaÃ§Ã£o: 66.67% (2/3)
â”‚  â”œâ”€ Performance: 94s por ciclo (aceitÃ¡vel)
â”‚  â””â”€ Throughput: 1.27 posts/minuto

â”œâ”€ Prioridades
â”‚  â”œâ”€ ğŸ”´ CRÃTICO: Fixar JSON parsing no AI Processor
â”‚  â”œâ”€ ğŸŸ¢ OK: English Captions Filtering funcionando
â”‚  â””â”€ ğŸŸ¢ OK: Pipeline Ã© resiliente (fallback funciona)

â””â”€ PrÃ³ximo Passo
   â””â”€ Investigar failed_ai_*.json para identificar raiz do erro

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âœ… ENGLISH CAPTION FILTERING: PHASE 9 EM PRODUÃ‡ÃƒO - FUNCIONANDO CORRETAMENTE  â•‘
â•‘      ğŸ”§ AÃ‡ÃƒO NECESSÃRIA: Investigar JSON parsing (problema do Gemini)          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

if __name__ == "__main__":
    print(RELATORIO)
